{
  "hash": "1bdb80a15e898670295617eff34da3fb",
  "result": {
    "engine": "knitr",
    "markdown": "# Results\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## Dataset structure\n\nIt would be cool to have a table here with the number of reactors for each treatment and habitat.\n\nThe OxiTop Control system measured pressure differences inside the reactor since the start of the incubation.\n\n::: {#fig-raw}\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npressures |> \n  filter(time %% 1 == 0) |> \n  ggplot(aes(x = time, y = pressure, group = reactor)) +\n  geom_line(alpha = .5) +\n  annotate(\n    geom = \"segment\",\n    arrow = arrow(type = \"open\", length = unit(10, \"points\")),\n    x    = 10, y    = -30,\n    xend = 14, yend = -11\n  ) +\n  annotate(\n    geom = \"segment\",\n    arrow = arrow(type = \"open\", length = unit(10, \"points\")),\n    x    = 10, y    = -30,\n    xend = 15, yend = -15\n  ) +\n  annotate(\n    geom = \"segment\",\n    arrow = arrow(type = \"open\", length = unit(10, \"points\")),\n    x    = 10, y    = -30,\n    xend = 16, yend = -22\n  ) +\n    annotate(\n    geom = \"label\", label = \"Reactors\\n(n = 30)\", size = 5,\n    x = 10, y = -30\n  ) +\n  labs(x = \"Time (days)\", y = \"Pressure difference (hPa)\")\n```\n\n::: {.cell-output-display}\n![](results_files/figure-pdf/unnamed-chunk-2-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n\n\n\n\nPressure difference evolution during the incubation. Lines represent individual reactor jars daily measures.\n:::\n\n## Pressure adjustment\n\nDifferences in pressure are adjusted offsetting from the mean value in the empty reactors---also called blanks. During the first couple of days, all blanks rose to approximately 9 hPa over the starting pressure (@fig-blanks). The response is likely due to warming air inside the reactor, because the incubator chamber was at 25Â°C, which was slightly above room temperature.\n\nReactor B27 lost pressure early in the experiment and dropped to zero, this behavior implies evident sealing defects and the reactor was not considered for the analysis.\n\nOur goal is to measure differences in pressure due to oxygen consumption ---or CO-2- production---, so we neutralized the effect of temperature by adjusting the pressure difference with the formula:\n\n$p_{OD} = p - \\overline{p}_{blanks}$\n\nWere $p_{OD}$ is the pressure difference driven by oxygen consumption, $p$ is the relative pressure of the reactors containing benthic habitats, and $\\overline{p}_{blanks}$ is the average relative pressure measured in empty reactors ---excluding reactor B27.\n\n::: {#fig-blanks}\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npressures |> \n  filter(treatment == \"blank\", time %% 1 == 0) |> \n  ggplot(aes(x = time, y = pressure, group = reactor)) +\n  geom_line(linewidth = 1, alpha = .5) +\n  facet_wrap(~ habitat, labeller = as_labeller(labels_habitat)) +\n  annotate(\n    geom = \"segment\", arrow = arrow(type = \"open\", length = unit(10, \"points\")),\n    x    = 10, y    = 6,\n    xend =  3, yend = 4\n  ) +\n  annotate(\n    geom = \"label\", label = \"Reactor B27\", size = 5,\n    x = 10, y = 6\n  ) +\n  labs(x = \"Time (days)\", y = \"Pressure difference (hPa)\")\n```\n\n::: {.cell-output-display}\n![](results_files/figure-pdf/unnamed-chunk-3-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n\n\n\n\nPressure difference evolution inside empty reactors. Reactor B27 annotated as outlier, probably due to sealing failure.\n:::\n\n::: {#fig-summary}\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npressures |> \n  filter(habitat != \"blank\", time %% 5 == 0, time > 0) |> \n  ggplot(aes(x = time, y = bod, fill = treatment)) +\n  geom_bar(stat = \"summary\", position = \"dodge\", fun = mean) +\n  geom_errorbar(stat = \"summary\", position = \"dodge\", fun.data = mean_se) +\n  facet_wrap(~ habitat, scale = \"free_y\", labeller = as_labeller(labels_habitat)) +\n  scale_x_continuous(breaks = seq(5, 30, 5))  +\n  scale_fill_discrete(labels = labels_treatment, name = NULL) +\n  labs(x = \"Time (days)\", y = \"Oxygen demand (mg/L)\") +\n  theme(\n    legend.position = \"inside\", legend.position.inside = c(.1, .8)\n  )\n```\n\n::: {.cell-output-display}\n![](results_files/figure-pdf/unnamed-chunk-4-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n\n\n\n\nBiological oxygen demand evolution summary. Bars represent mean values and error bars standard error.\n:::\n\n::: {#fig-curves}\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggrepel)\nset.seed(123)\n\nlabel_curves <- pressures |> \n  filter(time == 20, habitat != \"blank\") |> \n  group_by(habitat, treatment, time) |> \n  summarize(bod = mean(bod), .groups = \"drop\") |> \n  mutate(\n    treatment_label = case_match(treatment,\n      \"paper\" ~ \"Paper\",\n      \"plastic\" ~ \"Plastic\",\n      \"control\" ~ \"Control\"\n    )\n  )\n\npressures |>\n  filter(treatment != \"blank\") |> \n  ggplot(aes(x = time, y = bod, color = treatment)) +\n  geom_smooth(method = \"loess\", formula = y ~ x, se = FALSE) +\n  geom_label_repel(\n    data = label_curves,\n    aes(x = time, y = bod, label = treatment_label), direction = \"y\"\n  ) +\n  facet_wrap(~ habitat, scales = \"free_y\", labeller = as_labeller(labels_habitat)) +\n  labs(x = \"Time (days)\", y = \"Oxygen demand (mg/L)\") +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](results_files/figure-pdf/unnamed-chunk-5-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n\n\n\n\nSmoothed summary BOD curves using local polynomial regression fitting[^results-1].\n:::\n\n[^results-1]: Regression curves calculated with the R function `ggplot2::geom_smooth(method = \"loess\", formula = y \\~ x)` for visualization purposes only.\n\n## Modelling\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(nls.multstart)\n\nsingle_exp <- function(l, k, t){\n  l * (1 - exp(-k * t))\n}\n\ndouble_exp <- function(l1, l2, k1, k2, t){\n  l1 * (1 - exp(-k1 * t)) + l2 * (1 - exp(-k2 * t))\n}\n\nfits <- pressures |> \n  filter(habitat != \"blank\") |> \n  group_by(reactor, habitat, treatment) |> \n  nest() |> \n  mutate(\n    linear = map(data, ~ lm(bod ~ time, data = .x)),\n    single_exp = map(data, ~ nls_multstart(\n      bod ~ single_exp(l, k, t = time),\n      data = .x,\n      iter = 250,\n      start_lower = c(l = 0, k = .1),\n      start_upper = c(l = 1000, k1 = 10),\n      supp_errors = \"Y\"\n    )),\n    double_exp = map(data, ~ nls_multstart(\n      bod ~ double_exp(l1, l2, k1, k2, t = time),\n      data = .x,\n      iter = 250,\n      start_lower = c(l1 = 0, l2 = 0, k1 = .1, k2 = .001),\n      start_upper = c(l1 = 500, l2 = 1000, k1 = 10, k2 = 1),\n      supp_errors = \"Y\"\n    ))\n  )\n\nfits <- fits |> \n  pivot_longer(\n    c(linear, single_exp, double_exp),\n    names_to = \"formula\", values_to = \"fit\"\n  ) |> \n  mutate(\n    metrics = map(fit, glance),\n    params = map(fit, tidy),\n    preds = map(fit, augment)\n  )\n```\n:::\n",
    "supporting": [
      "results_files/figure-pdf"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}